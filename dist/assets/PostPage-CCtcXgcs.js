import{u as S,j as t,L as w,s as $,r as f,i as I,h as P,S as C,O as T}from"./index-B-RPJ948.js";const E="_transparentTop_dhkf0_4",B="_container_dhkf0_11",H="_content_dhkf0_14",O="_isLoading_dhkf0_17",F="_error_dhkf0_41",M="_noPost_dhkf0_44",R="_widget_dhkf0_47",d={transparentTop:E,container:B,content:H,isLoading:O,error:F,noPost:M,widget:R},W="_postArticle_4vvz3_4",q="_articleHeader_4vvz3_4",D="_postCategory_4vvz3_36",G="_categoryLink_4vvz3_60",J="_authorLink_4vvz3_63",K="_postImage_4vvz3_66",Q="_postBody_4vvz3_73",U="_postList_4vvz3_184",o={postArticle:W,articleHeader:q,postCategory:D,categoryLink:G,authorLink:J,postImage:K,postBody:Q,postList:U},V=[300,768,800,1024,1477];function X({source:c,sizes:r,className:u,loading:_="lazy"}){if(!c)return null;const g=V.map(p=>`${S(c).width(p).auto("format").url()} ${p}w`).join(", "),m=S(c).width(530).auto("format").url();return t.jsx("img",{src:m,srcSet:g,sizes:r,alt:c.alt||" ",className:u,loading:_})}function Y({post:c}){if(!c)return null;const{title:r,category:u,categorySlug:_,mainImage:g,imageAlt:m,content:p}=c,x=(i,n)=>{let s=t.jsx(f.Fragment,{children:i.text},n);return i.marks&&i.marks.length>0&&i.marks.forEach(j=>{j==="strong"&&(s=t.jsx("strong",{children:s},`${n}-strong`))}),s},v=i=>{if(!i)return null;const n=[],s=[],j=()=>{for(;s.length>0;){const e=s.pop(),l=e.tag,a=t.jsx(l,{className:o.postList,children:e.items},`list-${Math.random()}`);if(s.length>0){const h=s[s.length-1],y=h.items[h.items.length-1];h.items[h.items.length-1]=t.jsxs("li",{children:[y.props.children,a]},y.key)}else n.push(a)}};return i.forEach(e=>{const l=e.children?e.children.map((a,h)=>x(a,`${e._key}-${h}`)):null;if(e.listItem){const a=e.level||1,h=e.listItem==="number"?"ol":"ul";for(a>s.length&&(s.length>0&&a-s.length>1&&console.warn("List level inconsistency detected."),s.push({tag:h,items:[]}));a<s.length;){const N=s.pop(),A=N.tag,z=t.jsx(A,{className:o.postList,children:N.items},`list-${e._key}-${s.length}`),L=s[s.length-1],k=L.items[L.items.length-1];L.items[L.items.length-1]=t.jsxs("li",{children:[k.props.children,z]},k.key)}const y=s[s.length-1];y&&y.items.push(t.jsx("li",{children:l},e._key))}else switch(j(),e.style){case"h2":n.push(t.jsx("h2",{children:l},e._key));break;case"h3":n.push(t.jsx("h3",{children:l},e._key));break;case"h4":n.push(t.jsx("h4",{children:l},e._key));break;default:l&&l.some(a=>a.props.children!=="")&&n.push(t.jsx("p",{children:l},e._key));break}}),j(),n};return t.jsxs("article",{className:o.postArticle,children:[t.jsxs("div",{className:o.articleHeader,children:[t.jsx("h1",{className:o.postTitle,children:r}),t.jsxs("p",{className:o.postCategory,children:[t.jsx(w,{to:`/blog/${_}`,className:o.categoryLink,children:u})," / 作者：",t.jsx(w,{to:"/about",className:o.authorLink,children:$.siteAuthorName})]})]}),g&&t.jsx(X,{source:g,alt:m,className:o.postImage,sizes:"(max-width: 920px) 100vw, 800px",loading:"lazy"}),t.jsx("div",{className:o.postBody,children:v(p)})]})}function b(c){const[r,u]=f.useState(null),[_,g]=f.useState(!0),[m,p]=f.useState(null),{postSlug:x}=I();return f.useEffect(()=>{if(!x)return;const v=`*[_type == "post" && slug.current == $slug][0] {
    _id,
    "title": titleChinese,
    "slug":  slug.current,
    "mainImage": imageAndAlt[0].image,
    "imageAlt": imageAndAlt[0].imageAlt,
    "category": category[0]->categoryNameChinese,
    "categorySlug": category[0]->slug.current,
    "content": paragraph,
    }`,i={slug:x};g(!0),p(null),P.fetch(v,i).then(n=>{u(n)}).catch(n=>{console.error("Sanity fetch error:",n),p("無法載入文章，請稍後再試。")}).finally(()=>{g(!1)})},[x]),t.jsxs(t.Fragment,{children:[t.jsx(C,{title:r?r.title:"文章載入中...",description:r?r.excerpt||"文章內容":""}),t.jsx("div",{className:d.transparentTop}),t.jsxs("div",{className:d.container,children:[t.jsx(T,{className:d.content,children:_?t.jsx("p",{className:d.isLoading,children:"文章載入中...請稍候"}):m?t.jsx("p",{className:d.error,children:m}):r?t.jsx(Y,{post:r}):t.jsx("p",{className:d.noPost,children:"文章不存在"})}),t.jsx("div",{className:d.widget,children:t.jsx("p",{children:"Widget"})})]})]})}export{b as default};
